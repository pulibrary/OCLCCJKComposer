'MacroName:ComposeAllFields
'MacroDescription:Compose Korean Hangul and Japanese Kana from individual components in all fields
'Macro written by: Thomas Ventimiglia, Princeton University East Asian Library 
'Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License.
'You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
'Macro Created: 20 October 2025
'Macro last modified: 21 October 2025
'Macro version: 0.2.0

Sub Main
   
   Dim CS As Object
On Error Resume Next
   Set CS = GetObject(,"Connex.Client")
On Error GoTo 0
   If CS Is Nothing Then
      Set CS = CreateObject("Connex.Client")
   End If
   
   iInitialPosition = CS.CursorRow
   
   CS.EndRecord
   
   iMaxField = CS.CursorRow
   CS.HomeRecord
   Dim sField As String
   
   
   While CS.GetFieldLineUnicode(CS.CursorRow, sField)
      If InStr(1,sField,"&#x11") > 0 Or InStr(1,sField,"&#x3099") > 0 Or InStr(1,sField,"&#x309A") > 0 Then
         CS.RunMacro "CJKComposer!ComposeSingleField"
      End If
      If CS.CursorRow = iMaxField Then
        Goto Done
      End If
      CS.CursorRow = CS.CursorRow + 1 
   Wend
Done:
   CS.CursorRow = iInitialPosition

End Sub
